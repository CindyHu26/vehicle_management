<div 
  class="fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center z-50"
  hx-on:click="if (event.target === this) this.remove()"
>
  <script src="//unpkg.com/alpinejs" defer></script>
  
  <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-lg relative"
       x-data="{ assignment_type: '{{ spot.status.value or 'empty' }}' }"
  >
    
    <div class="absolute top-0 right-0 pt-4 pr-4">
      <button 
        type="button"
        class="text-gray-400 hover:text-gray-600 transition duration-150 ease-in-out"
        onclick="this.closest('.fixed').remove()"
        aria-label="Close"
      >
        <svg class="h-6 w-6" stroke="currentColor" fill="none" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <h2 class="text-2xl font-semibold mb-4">
      指派車位 ({{ spot.spot_number }})
    </h2>

    <form 
      hx-post="/parking-spot/{{ spot.id }}/assign"
      hx-swap="none"
    >
      <div class="space-y-4">
        
        <div>
          <label class="block text-sm font-medium text-gray-700">指派類型</label>
          <div class="mt-2 flex space-x-4">
            <label class="flex items-center">
              <input type="radio" name="assignment_type" value="empty" 
                     x-model="assignment_type"
                     class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300">
              <span class="ml-2 text-sm text-gray-700">清空車位</span>
            </label>
            <label class="flex items-center">
              <input type="radio" name="assignment_type" value="company_vehicle" 
                     x-model="assignment_type"
                     class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300">
              <span class="ml-2 text-sm text-gray-700">公司車</span>
            </label>
            <label class="flex items-center">
              <input type="radio" name="assignment_type" value="private_vehicle" 
                     x-model="assignment_type"
                     class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300">
              <span class="ml-2 text-sm text-gray-700">私車</span>
            </label>
          </div>
        </div>

        <div x-show="assignment_type === 'company_vehicle'" class="space-y-4 border-t pt-4">
          <div>
            <label for="vehicle_id" class="block text-sm font-medium text-gray-700">選擇公司車</label>
            <select name="vehicle_id" id="vehicle_id" 
                    class="mt-1 block w-full searchable-select">
              <option value="">-- 請選擇公司車 --</option>
              {% for v in all_vehicles %}
                <option value="{{ v.id }}" {% if spot.assigned_vehicle_id == v.id %}selected{% endif %}>
                  {{ v.plate_no }} ({{ v.user.name if v.user else '無' }} / {{ v.model or '' }})
                </option>
              {% endfor %}
            </select>
          </div>
        </div>
        
        <div x-show="assignment_type === 'private_vehicle'" class="space-y-4 border-t pt-4">
          <div>
            <label for="employee_id" class="block text-sm font-medium text-gray-700">私車車主</label>
            <select name="employee_id" id="employee_id" 
                    class="mt-1 block w-full searchable-select">
              <option value="">-- 請選擇車主 --</option>
              {% for emp in all_employees %}
                <option value="{{ emp.id }}" {% if spot.assigned_employee_id == emp.id %}selected{% endif %}>
                  {{ emp.name }}{{ " / " ~ emp.phone if emp.phone else "" }}
                </option>
              {% endfor %}
            </select>
          </div>
          <div>
            <label for="private_plate_no" class="block text-sm font-medium text-gray-700">私車車牌</label>
            <input type="text" name="private_plate_no" id="private_plate_no" 
                   value="{{ spot.private_plate_no or '' }}"
                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
          </div>
        </div>
        
        <div x-show="assignment_type !== 'empty'" class="border-t pt-4">
          <label for="notes" class="block text-sm font-medium text-gray-700">備註</label>
          <textarea name="notes" id="notes" rows="2"
              class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
          >{{ spot.notes or '' }}</textarea>
        </div>

      </div>

      <div class="mt-6 flex justify-end space-x-3">
        <span class="save-status text-green-600 text-sm"></span>
        <button type="button" 
                class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300"
                hx-on:click="this.closest('.fixed').remove()"
        >
          取消
        </button>
        <button type="submit"
                class="bg-blue-600 text-white px-4 py-2 rounded-lg shadow hover:bg-blue-700"
        >
          儲存指派
        </button>
      </div>
    </form>

  </div>
</div>