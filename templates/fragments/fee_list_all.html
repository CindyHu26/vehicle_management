<div class="overflow-x-auto bg-white border border-gray-200 rounded-lg shadow-md">
  <table class="min-w-full divide-y divide-gray-200">
    <thead class="bg-gray-100">
      <tr>
        <th class="px-3 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">æ“ä½œ</th>
        
        <th 
          class="px-3 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider cursor-pointer"
          hx-get="/fee-list-all"
          hx-vals='{
            "filter_user_id": "{{ query_params.get("filter_user_id", "") }}",
            "filter_fee_type": "{{ query_params.get("filter_fee_type", "") }}",
            "filter_is_paid": "{{ query_params.get("filter_is_paid", "") }}",
            "sort_by": "receive_date",
            "sort_order": "{% if current_sort_by == "receive_date" and current_sort_order == "asc" %}desc{% else %}asc{% endif %}"
          }'
          hx-target="#fee-list-container" hx-swap="innerHTML"
        >
          æ”¶åˆ°å–®æ“šæ—¥
          {% if current_sort_by == "receive_date" %}{{ "ğŸ”¼" if current_sort_order == "asc" else "ğŸ”½" }}{% endif %}
        </th>
        
        <th 
          class="px-3 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider cursor-pointer"
          hx-get="/fee-list-all"
          hx-vals='{
            "filter_user_id": "{{ query_params.get("filter_user_id", "") }}",
            "filter_fee_type": "{{ query_params.get("filter_fee_type", "") }}",
            "filter_is_paid": "{{ query_params.get("filter_is_paid", "") }}",
            "sort_by": "user_id",
            "sort_order": "{% if current_sort_by == "user_id" and current_sort_order == "asc" %}desc{% else %}asc{% endif %}"
          }'
          hx-target="#fee-list-container" hx-swap="innerHTML"
        >
          è«‹æ¬¾äºº
          {% if current_sort_by == "user_id" %}{{ "ğŸ”¼" if current_sort_order == "asc" else "ğŸ”½" }}{% endif %}
        </th>

        <th class="px-3 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">è²»ç”¨é¡å‹</th>
        
        <th 
          class="px-3 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider cursor-pointer"
          hx-get="/fee-list-all"
          hx-vals='{
            "filter_user_id": "{{ query_params.get("filter_user_id", "") }}",
            "filter_fee_type": "{{ query_params.get("filter_fee_type", "") }}",
            "filter_is_paid": "{{ query_params.get("filter_is_paid", "") }}",
            "sort_by": "vehicle_id",
            "sort_order": "{% if current_sort_by == "vehicle_id" and current_sort_order == "asc" %}desc{% else %}asc{% endif %}"
          }'
          hx-target="#fee-list-container" hx-swap="innerHTML"
        >
          é—œè¯è»Šè¼›
          {% if current_sort_by == "vehicle_id" %}{{ "ğŸ”¼" if current_sort_order == "asc" else "ğŸ”½" }}{% endif %}
        </th>

        <th 
          class="px-3 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider cursor-pointer"
          hx-get="/fee-list-all"
          hx-vals='{
            "filter_user_id": "{{ query_params.get("filter_user_id", "") }}",
            "filter_fee_type": "{{ query_params.get("filter_fee_type", "") }}",
            "filter_is_paid": "{{ query_params.get("filter_is_paid", "") }}",
            "sort_by": "amount",
            "sort_order": "{% if current_sort_by == "amount" and current_sort_order == "asc" %}desc{% else %}asc{% endif %}"
          }'
          hx-target="#fee-list-container" hx-swap="innerHTML"
        >
          é‡‘é¡
          {% if current_sort_by == "amount" %}{{ "ğŸ”¼" if current_sort_order == "asc" else "ğŸ”½" }}{% endif %}
        </th>

        <th class="px-3 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">å·²ä»˜æ¬¾</th>
        <th class="px-3 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">ç™¼ç¥¨è™Ÿç¢¼</th>
        <th class="px-3 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">å‚™è¨»/é …ç›®</th>
      </tr>
    </thead>
    <tbody class="bg-white divide-y divide-gray-200">
      {% if not fee_records %}
        <tr>
          <td colspan="9" class="px-4 py-4 text-center text-sm text-gray-500">
            å°šç„¡è²»ç”¨ç´€éŒ„
          </td>
        </tr>
      {% endif %} 
      
      {% for record in fee_records %}
      <tr class="hover:bg-gray-50 text-sm">

        <td class="px-3 py-3 whitespace-nowrap text-left font-medium">
          <button
            class="text-green-600 hover:text-green-900"
            hx-get="/attachments/manage/fee/{{ record.id }}"
            hx-target="#modal-container"
            hx-swap="beforeend"
            title="é™„ä»¶"
          >
            é™„ä»¶
          </button>
          <button
            class="text-blue-600 hover:text-blue-900 ml-2"
            hx-get="/fee/{{ record.id }}/edit"
            hx-target="#modal-container"
            hx-swap="beforeend"
          >
            ç·¨è¼¯
          </button>
          <button
            class="text-red-600 hover:text-red-900 ml-2"
            hx-delete="/fee/{{ record.id }}/delete"
            hx-target="closest tr"
            hx-swap="outerHTML"
            hx-confirm="ç¢ºå®šè¦åˆªé™¤é€™ç­†è²»ç”¨ç´€éŒ„å—ï¼Ÿ"
          >
            åˆªé™¤
          </button>
        </td>

        <td class="px-3 py-3 whitespace-nowrap text-gray-900 cursor-pointer" hx-get="/fee/{{ record.id }}/edit" hx-target="#modal-container" hx-swap="beforeend">
          {{ record.receive_date.strftime('%Y-%m-%d') if record.receive_date else '' }}
        </td>
        <td class="px-3 py-3 whitespace-nowrap text-gray-700 cursor-pointer" hx-get="/fee/{{ record.id }}/edit" hx-target="#modal-container" hx-swap="beforeend">
          {{ record.user.name if record.user else '' }}
        </td>
        <td class="px-3 py-3 whitespace-nowrap text-gray-700 cursor-pointer" hx-get="/fee/{{ record.id }}/edit" hx-target="#modal-container" hx-swap="beforeend">
          {{ fee_type_map.get(record.fee_type.value, record.fee_type.value) }}
        </td>
        <td class="px-3 py-3 whitespace-nowrap font-medium text-blue-600 cursor-pointer" hx-get="/fee/{{ record.id }}/edit" hx-target="#modal-container" hx-swap="beforeend">
          {{ record.vehicle.plate_no if record.vehicle else '' }}
        </td>
        <td class="px-3 py-3 whitespace-nowrap text-gray-700 text-right cursor-pointer" hx-get="/fee/{{ record.id }}/edit" hx-target="#modal-container" hx-swap="beforeend">
          {{ "NT$ {:,.0f}".format(record.amount) if record.amount else '' }}
        </td>
        <td class="px-3 py-3 whitespace-nowrap text-gray-700 text-center cursor-pointer" hx-get="/fee/{{ record.id }}/edit" hx-target="#modal-container" hx-swap="beforeend">
          {{ "âœ”ï¸" if record.is_paid else "âŒ" }}
        </td>
        <td class="px-3 py-3 whitespace-nowrap text-gray-700 cursor-pointer" hx-get="/fee/{{ record.id }}/edit" hx-target="#modal-container" hx-swap="beforeend">
          {{ record.invoice_number or '' }}
        </td>
        <td class="px-3 py-3 text-gray-700 truncate cursor-pointer" style="max-width: 200px;" hx-get="/fee/{{ record.id }}/edit" hx-target="#modal-container" hx-swap="beforeend">
          {{ record.notes or '' }}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>